description: fix directory traversal issues in miniunzip
author: Michael Gilbert <mgilbert@debian.org>
bug-debian: https://bugs.debian.org/774321
bug-debian: https://bugs.debian.org/776831

--- a/contrib/minizip/miniunz.c
+++ b/contrib/minizip/miniunz.c
@@ -367,6 +367,20 @@ int do_extract_currentfile(uf,popt_extra
         else
             write_filename = filename_withoutpath;
 
+        if (write_filename[0]!='\0')
+        {
+            const char* relative_check = write_filename;
+            while (relative_check[1]!='\0')
+            {
+                if (relative_check[0]=='.' && relative_check[1]=='.')
+                    write_filename = relative_check;
+                relative_check++;
+            }
+        }
+
+        while (write_filename[0]=='/' || write_filename[0]=='.')
+            write_filename++;
+
         err = unzOpenCurrentFilePassword(uf,password);
         if (err!=UNZ_OK)
         {
